<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="author" content="Tom" />
    <meta name="robots" content="index, follow"/>

    <meta property="og:title" content=""Working with Props Files""/>
    <meta property="og:url" content="https://teeks99.github.io/writing/working-with-props-files.html"/>
    <meta property="og:site_name" content="Tom's Writing"/>
    <meta property="og:type" content="article"/>

    <link rel="canonical" href="https://teeks99.github.io/writing/working-with-props-files.html" />

    <title>"Working with Props Files" | Tom's Writing</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" type="text/css" />

    <link rel="stylesheet" href="https://teeks99.github.io/writing/theme/css/main.css" type="text/css" />
    <link href="https://teeks99.github.io/writing/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Tom's Writing Atom Feed" />

    <script type="text/javascript">var switchTo5x=true;</script>
    <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">
        stLight.options({
            publisher: "",
            doNotHash: false,
            doNotCopy: false,
            hashAddressBar: false
        });
    </script>
</head>

<body id="index">
    <div class="row-fluid">
        <div class="span10 offset1">
            <header id="banner" >
                <h1>
                    <a href="https://teeks99.github.io/writing/">Tom's Writing </a>
                </h1>
                <nav class="navbar">
                    <div class="navbar-inner">
                        <ul class="nav">
                            <li class="active"><a href="https://teeks99.github.io/writing/category/programming.html">programming</a></li>
                        </ul>

                    </div>
                </nav>
            </header><!-- /#banner -->
        </div>
    </div>

    <div class="row-fluid">
        <div class="span10 offset1">
            <div class="row-fluid">
<div class="span10 offset1">
  <section>
    <article>
      <header>
        <h1 class="entry-title">
          <a href="https://teeks99.github.io/writing/working-with-props-files.html" rel="bookmark"
             title="Permalink to "Working with Props Files"">"Working with Props Files"</a></h1>
      </header>
      <div class="entry-content">
<footer class="post-info">
    <address class="vcard author">
        by <a class="url fn" href="https://teeks99.github.io/writing/author/tom.html">Tom</a>
    </address>

    in <a href="https://teeks99.github.io/writing/category/programming.html">programming</a>

    on 2018-03-06




    
</footer><!-- /.post-info -->

        <p>Visual Studio/MSBuild props files are handy little settings files that can be included</p>
<pre><code>&lt;Import Project="path\to\file.props" /&gt;
</code></pre>
<p>in vcxproj files or other props files.</p>
<p>These can simply define variables</p>
<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;Project DefaultTargets="Build" ToolsVersion="4.0" xmlns="http://schemas.microsoft.com/developer/msbuild/2003"&gt;
  &lt;PropertyGroup&gt;
    &lt;MyIncludePath&gt;C:/Path/To/Include&lt;/MyIncludePath&gt;
    &lt;MyLibPath&gt;C:/Path/To/Lib&lt;/MyLibPath&gt;
  &lt;/PropertyGroup&gt;
&lt;/Project&gt;
</code></pre>
<p>Which can then be used in a .vcxproj that has already imported that props file with the variables <code>$(MyIncludePath)</code> and <code>$(MyLibPath)</code>, for example:</p>
<pre><code>&lt;ClCompile&gt;
  &lt;AdditionalIncludeDirectories&gt;..\local\inc;$(MyIncludePath);%(AdditionalIncludeDirectories)&lt;/AdditionalIncludeDirectories&gt;
  &lt;RuntimeLibrary&gt;MultiThreadedDebug&lt;/RuntimeLibrary&gt;
&lt;/ClCompile&gt;
&lt;Link&gt;
  &lt;SubSystem&gt;Console&lt;/SubSystem&gt;
  &lt;AdditionalLibraryDirectories&gt;$(MyLibPath);%(AdditionalLibraryDirectories)&lt;/AdditionalLibraryDirectories&gt;
  &lt;AdditionalDependencies&gt;%(AdditionalDependencies)&lt;/AdditionalDependencies&gt;
&lt;/Link&gt;
</code></pre>
<p>These variables can build on each other as well, a line further down the file can use variables from a line above it. </p>
<pre><code>&lt;PropertyGroup&gt;
  &lt;FirstPath&gt;path/to/first&lt;/FirstPath&gt;
  &lt;SecondPath&gt;path/to/second&lt;/SecondPath&gt;
  &lt;AllPaths&gt;$(FirstPath);$(SecondPath)&lt;/AllPaths&gt;
&lt;/PropertyGroup&gt;
</code></pre>
<p>Groups, like <a href="https://docs.microsoft.com/en-us/visualstudio/msbuild/propertygroup-element-msbuild">PropertyGroup</a>, <a href="https://docs.microsoft.com/en-us/visualstudio/msbuild/itemdefinitiongroup-element-msbuild">ItemDefinitionGroup</a>s, etc. can also have <a href="https://docs.microsoft.com/en-us/visualstudio/msbuild/msbuild-conditions">Conditions</a>. These conditions often take the form of <code>Condition="'stringA'=='stringB'"</code>, which can be very useful when using variables, including those added by msbuild/visual studio.</p>
<pre><code>&lt;PropertyGroup Condition="'$(PlatformToolset)'=='v100'"&gt;
  &lt;MyVersion&gt;msvc-10.0&lt;/MyVersion&gt;
&lt;/PropertyGroup&gt;
&lt;PropertyGroup Condition="'$(PlatformToolset)'=='v140'"&gt;
  &lt;MyVersion&gt;msvc-14.0&lt;/MyVersion&gt;
&lt;/PropertyGroup&gt;
</code></pre>
<p>The above will set <code>MyVersion</code> to a value specific to the platform toolset that visual studio is using to build the code. This is defined by default in .vcxproj files. Because it gets defined in the .vcxproj, using it requires that the props file isn't imported until after the variable it depends on has been defined. Where this happens isn't particularly ovbious, so a good rule of thumb is to import user props files after the provided `<PropertyGroup Label="UserMacros" /> line. </p>
<p>It is common that one would like to append new values to existing variables like for the include path, library search path, etc. Look through the <a href="https://docs.microsoft.com/en-us/visualstudio/msbuild/cl-task">CL Task Parameters</a> and <a href="https://docs.microsoft.com/en-us/visualstudio/msbuild/link-task">Link Task Parameters</a> for more. Since these already exist they need to be appended to instead of set. For example:</p>
<pre><code>&lt;AdditionalIncludeDirectories&gt;path/to/dir;$(PathInVar);%(AdditionalIncludeDirectories)&lt;/AdditionalIncludeDirectories&gt;
</code></pre>
<p>Here the name of the variable is included at the end with a percent sign <code>%</code> in front of it. That tells it to use the existing one at the end. </p>
<p>For the CL and Link options, they cannot be set as variables in property groups, they need to match up with the existing variables in the heirarchy. Specifically:</p>
<pre><code>&lt;ItemDefinitionGroup&gt;
  &lt;ClCompile&gt;
    &lt;AdditionalIncludeDirectories&gt;path/to/dir;$(PathInVar);%(AdditionalIncludeDirectories)&lt;/AdditionalIncludeDirectories&gt;
    &lt;PreprocessorDefinitions&gt;SOMETHING_DEFINED;%(PreprocessorDefinitions)&lt;/PreprocessorDefinitions&gt;
  &lt;/ClCompile&gt;
  &lt;Link&gt;
    &lt;AdditionalLibraryDirectories&gt;path/to/libs;$(PathInVar);%(AdditionalLibraryDirectories)&lt;/AdditionalLibraryDirectories&gt;
    &lt;AdditionalDependencies&gt;my.lib;%(AdditionalDependencies)&lt;/AdditionalDependencies&gt;
  &lt;/Link&gt;
&lt;/ItemDefinitionGroup&gt;
</code></pre>
<p>It can also look at empty/unset variables and set default options for them. For example, we want to have a <code>libmy.lib</code> named <code>libmyd.lib</code> if it is being built with the <code>$(MyLibConf)</code> variable set to Debug. However, it is common that users who are building a project with the <code>$(Configuration)</code> set to Debug will also want this, and we don't want them to be forced to specify our <code>$(MyLibConf)</code> in this case. So we can detect if it is empty <em>and</em> the <code>$(Configuration)</code> is set to debug, then add the <code>d</code> suffix. </p>
<pre><code>&lt;PropertyGroup Condition="'$(MyLibConf)'=='' and '$(Configuration)'=='Debug'"&gt;
  &lt;MyLibConf&gt;Debug&lt;/MyLibConf&gt;
&lt;/PropertyGroup&gt;

&lt;PropertyGroup Condition="'$(MyLibConf)'=='Debug'"&gt;
  &lt;MyLibSuffix&gt;d&lt;/MyLibSuffix&gt;
&lt;/PropertyGroup&gt;

&lt;PropertyGroup&gt;
  &lt;MyLibName&gt;libmy$(MyLibSuffix).lib&lt;/MyLibName&gt;
&lt;/PropertyGroup&gt;
</code></pre>

      </div><!-- /.entry-content -->

    </article>
  </section>
</div>
            </div>
        </div>
    </div>

    <footer id="site-footer">
        <div class="row-fluid">
            <div class="span10 offset1">
                <address>
                    <p>
                        This blog is proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                    </p>
                    <p>
                        <a href="http://github.com/jsliang/pelican-fresh/">Fresh</a> is a responsive theme designed by <a href="http://jsliang.com/">jsliang</a> and <a href="https://github.com/jsliang/pelican-fresh/graphs/contributors">contributors</a>.
                        Special thanks to <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a> and <a href="http://getbootstrap.com/">Twitter Bootstrap</a>.
                    </p>
                </address>
            </div>
        </div>
    </footer>

    <script src="//code.jquery.com/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/2.3.2/js/bootstrap.min.js"></script>

    <script>
        $(document).ready(function () {
            $("table").attr("class","table table-condensed table-bordered");
        });
    </script>
     
</body>
</html>